<!doctype html>
<html>
  <head>
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-latest.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery.terminal/js/jquery.terminal.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/jquery.terminal/css/jquery.terminal.min.css" rel="stylesheet"/>
    <script src="https://pyodide.cdn.iodide.io/pyodide.js"></script>
    <script src="pyWeb.js"></script>

    <style>
        body, html {
            height: 100%;
            font: 1rem 'Fira Sans', sans-serif;
        }
        body {
            margin:0;
            display:flex;
            flex-wrap:wrap;
        }
        #terminal {
            width:50%;
            min-height:100%;
            max-height:100%;
        }
        #right {
            width:50%;
            min-height:100%;
            word-break: break-all;
            word-wrap: break-word;
        }
        #sometext {
            padding: 3px;
        }
        </style>
  </head>
  <body>
    <div id="terminal"></div>
    <div id = "right">
        <div id = "sometext">change me</div>
        <input type="button" id="changetext-button" value="Click to change text"">
        <br/><br/><br/>
        <input type="button" id="createcanvas-button" 
        value="Click to create a drawable canvas"">

    </div>
    <script>
        pyWeb.new('#terminal').then( () => {
            document.getElementById("changetext-button").onclick = () => {
                pyWeb.runCode('js.sometext.innerHTML += "a"')
            }
            
            document.getElementById("createcanvas-button").onclick = () => {
                pyWeb.runCode(String.raw`
                # nicked from the iodide example notebook.

                info = js.document.createElement('div')
                info.id = 'canvas-info'
                info.innerHTML = 'Draw on the canvas'
                js.right.appendChild(info)

                canvas = js.document.createElement('canvas')
                canvas.id = 'canvas'
                js.right.appendChild(canvas)
                dim = int(canvas.parentElement.offsetWidth*0.9)
                canvas.setAttribute('width', dim)
                canvas.setAttribute('height', dim)
                canvas.style.border = '3px solid #c61bfa'
                context = canvas.getContext("2d")
                context.strokeStyle = "#df4b26"
                context.lineJoin = "round"
                context.lineWidth = 8
                pen = False
                lastPoint = (0, 0)

                def onmousemove(e):
                    global lastPoint
                    if pen:
                        newPoint = (e.offsetX, e.offsetY)
                        context.beginPath()
                        context.moveTo(lastPoint[0], lastPoint[1])
                        context.lineTo(newPoint[0], newPoint[1])
                        context.closePath()
                        context.stroke()
                        lastPoint = newPoint
                    
                def onmousedown(e):
                    global pen, lastPoint
                    pen = True
                    lastPoint = (e.offsetX, e.offsetY)
                
                def onmouseup(e):
                    global pen
                    pen = False

                canvas.addEventListener('mousemove', onmousemove)
                canvas.addEventListener('mousedown', onmousedown)
                canvas.addEventListener('mouseup', onmouseup)
                `)
            }



        })
        /*
        pyWeb.new('terminal').then( () => {
            console.log('pyWeb loaded')
            pyWeb.loadPackage('numpy').then( () => {
                console.log('numpy loaded');
            })
        })
        */

        /*
        term.exec('')
        term.exec('# To import a python package you must:')
        term.exec('#     1. Load the files into the virtual filesystem')
        term.exec('#     2. import the package like normal')
        term.exec('')
        term.exec('js.loadPackageFlagged("numpy")  # Load the files into the virtual filesystem')
        term.exec('import numpy as np  # import it as normal')
        term.exec('')
        term.exec('a = np.array([1, 2, 3])')
        term.exec('a')
        term.exec('print(a)')
        */
    </script>
  </body>
</html>
